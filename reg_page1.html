<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <style>
        body {
            border-color: rgb(255, 196, 0);
        }

        p {
            text-align: center;
        }

        h1 {
            color: goldenrod;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Book a Call</h1><br>
        <p>Book a call and our representative will call you within 1 hour of selected time </p>
        <hr><br>

        <form onsubmit="userDetail(event)">
            <label for="aname" class="form-label">Name:</label>
            <input type="text" id="aname" name="aname" class="form-control form-control-sm">
            <lable for="aemail" class="form-label">Email:</lable>
            <input type="email" id="aemail" name="aemail" class="form-control form-control-sm">
            <label for="aphone" class="form-label">Phone:</label>
            <input type="tel" id="aphone" name="aphone" class="form-control form-control-sm">

            <input type="submit" id="addbtn" name="getvalue" value="GET A CALL" class="btn btn-warning btn-block">

        </form>
    </div>
    <div id="display">

    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    <script>
        const delbtn = document.getElementById('delbtn');
        function userDetail(event) {
            event.preventDefault();
            const display = document.getElementById('display');
            const aname = document.getElementById('aname').value;
            const aemail = document.getElementById('aemail').value;
            const aphone = document.getElementById('aphone').value;

            //creating object
            const myobj = {
                aname, aemail, aphone,
            };
            postdata(myobj);

        }
        //Posting data to Database on clicking Get A call button
        async function postdata(obj) {
            try {
                var res = await axios.post("http://localhost:5000/add", obj);
                console.log(res.data);
                console.log('this is the data');
                adduser(res.data.userdata);
            }
            catch (err) {
                console.log(err);
            }
        }

        //Adding user to screen on clicking Get A call button
        function adduser(myobj) {
            const li = document.createElement('li');
            li.appendChild(document.createTextNode(myobj.name));
            li.appendChild(document.createTextNode('-'));
            li.appendChild(document.createTextNode(myobj.phone));
            li.appendChild(document.createTextNode('-'));
            li.appendChild(document.createTextNode(myobj.email));

            const del = document.createElement('button');

            del.appendChild(document.createTextNode('DELETE'));
            del.id = 'delbtn';
            li.appendChild(del);

            display.appendChild(li);

            del.addEventListener('click', (e) => {
                e.preventDefault();
                display.removeChild(li);
                delfunction(myobj.phone);
            })


        }

        //calling function on reload
        window.addEventListener("DOMContentLoaded", () => {
            showonreload();
        })

        //defining showonreload function
        async function showonreload() {
            try {
                var res = await axios.get('http://localhost:5000/data');
                for (let i = 0; i < res.data.alldata.length; i++) {
                    adduser(res.data.alldata[i]);
                }
            }
            catch (err) {
                console.log(err);
            }
        }
        //Deleting data on clicking delete button from Database
        async function delfunction(obj) {
            try {
                const myobj = { phone: obj };
                var res = await axios.post('http://localhost:5000/delete', myobj);
                console.log('deletion successful');
            }
            catch (err) {
                console.log('deletion failed');
                console.log(err);
            }
        }


    </script>
    <script src="app.js"> </script>
</body>

</html>